<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Game with Weapon Unlocks, Inventory & Random Items</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; background: #87CEEB; }
        .controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
        .controls button { width: 60px; height: 60px; font-size: 20px; background-color: #333; color: white; border: none; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div class="controls">
        <button id="left">‚¨ÖÔ∏è</button>
        <button id="up">‚¨ÜÔ∏è</button>
        <button id="right">‚û°Ô∏è</button>
        <button id="down">‚¨áÔ∏è</button>
        <button id="shoot">üî´</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        window.addEventListener("resize", resizeCanvas);
        resizeCanvas(); 

        // Player object
        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            width: 30,
            height: 30,
            color: "blue",
            speed: 5,
            health: 100,
            ammo: 30,
            weapon: null,
            inventory: [] // Store up to 2 weapons
        };

        // Weapons
        const mythicSkyeAssaultRifle = {
            name: "Mythic Skye's Assault Rifle",
            damage: 25,
            fireRate: 300,
            ammoCapacity: 100,
            reloadTime: 2000,
            color: "#6B3FA0",
            type: "assault_rifle"
        };

        const goldPumpShotgun = {
            name: "Gold Pump Shotgun",
            damage: 100,
            fireRate: 1000,
            ammoCapacity: 5,
            reloadTime: 2500,
            color: "#FFD700",
            type: "shotgun"
        };

        // Enemy object
        let enemyCount = 0;
        const enemies = [];

        // Item spawn chances
        const commonItems = [
            mythicSkyeAssaultRifle
        ];

        const legendaryItems = [
            goldPumpShotgun
        ];

        // Random item spawn function
        function spawnRandomItem() {
            let spawnChance = Math.random();
            let item = null;

            if (spawnChance < 0.9) {
                item = commonItems[Math.floor(Math.random() * commonItems.length)];
            } else {
                item = legendaryItems[Math.floor(Math.random() * legendaryItems.length)];
            }

            return {
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                item: item
            };
        }

        // Boss Object
        const boss = {
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            width: 100,
            height: 100,
            health: 500,
            color: "purple",
            defeated: false
        };

        // Handle movement controls
        let keys = {};

        window.addEventListener("keydown", (e) => {
            keys[e.key] = true;
        });

        window.addEventListener("keyup", (e) => {
            keys[e.key] = false;
        });

        // Handle movement and shooting
        window.addEventListener("keydown", (e) => {
            if (e.key === "ArrowUp") player.y -= player.speed;
            if (e.key === "ArrowDown") player.y += player.speed;
            if (e.key === "ArrowLeft") player.x -= player.speed;
            if (e.key === "ArrowRight") player.x += player.speed;
        });

        // WebRTC Setup (Same as before)
        let localConnection;
        let sendChannel;
        let receiveChannel;

        let isOfferer = localStorage.getItem("isOfferer") === "true";
        let signalingKey = "webrtc_game_signal";

        if (isOfferer) {
            createOffer();
        } else {
            createReceiver();
        }

        function createOffer() {
            localConnection = new RTCPeerConnection();
            sendChannel = localConnection.createDataChannel("sendChannel");

            sendChannel.onopen = () => console.log("Data channel opened");
            sendChannel.onmessage = (e) => handleMessage(e.data);

            localConnection.createOffer()
                .then(offer => localConnection.setLocalDescription(offer))
                .then(() => {
                    localStorage.setItem(signalingKey, JSON.stringify(localConnection.localDescription));
                    alert("Offer created, now open this URL in another browser.");
                });
        }

        function createReceiver() {
            localConnection = new RTCPeerConnection();

            localConnection.ondatachannel = (event) => {
                receiveChannel = event.channel;
                receiveChannel.onmessage = (e) => handleMessage(e.data);
            };

            let offer = JSON.parse(localStorage.getItem(signalingKey));
            localConnection.setRemoteDescription(new RTCSessionDescription(offer))
                .then(() => localConnection.createAnswer())
                .then(answer => localConnection.setLocalDescription(answer))
                .then(() => {
                    localStorage.setItem(signalingKey, JSON.stringify(localConnection.localDescription));
                });
        }

        function handleMessage(data) {
            const playerData = JSON.parse(data);
            player.x = playerData.x;
            player.y = playerData.y;
            player.health = playerData.health;
            player.ammo = playerData.ammo;
            if (playerData.weapon) {
                player.weapon = playerData.weapon;
            }
        }

        // Check for weapon unlock
        function checkWeaponUnlock() {
            if (enemyCount >= 10 && !player.inventory.includes(goldPumpShotgun)) {
                player.inventory.push(goldPumpShotgun);
            }

            if (enemyCount >= 25 && !player.inventory.includes(mythicSkyeAssaultRifle)) {
                player.inventory.push(mythicSkyeAssaultRifle);
            }
        }

        // Enemy defeat
        function defeatEnemy() {
            enemyCount++;
            checkWeaponUnlock();
        }

        // Pick up item
        function pickUpItem(item) {
            if (player.inventory.length < 2) {
                player.inventory.push(item);
            } else {
                // Swap item if inventory is full
                player.inventory[0] = item;
            }
        }

        // Draw game
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw player
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);

            // Draw weapons in inventory
            player.inventory.forEach((weapon, index) => {
                ctx.fillStyle = weapon.color;
                ctx.fillRect(player.x + player.width / 2 - 15, player.y - 30 * (index + 1), 30, 30); // Display weapon above player
            });

            // Draw items on floor
            items.forEach(item => {
                ctx.fillStyle = item.item.color;
                ctx.beginPath();
                ctx.arc(item.x, item.y, 10, 0, 2 * Math.PI);
                ctx.fill();
            });

            // Draw boss
            if (!boss.defeated) {
                ctx.fillStyle = boss.color;
                ctx.fillRect(boss.x, boss.y, boss.width, boss.height);
            }
        }

        // Game loop
        let items = [spawnRandomItem(), spawnRandomItem()]; // Spawn random items
        function gameLoop() {
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
